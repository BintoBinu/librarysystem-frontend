<div class="dashboard-container">
  <!-- ===== NAVBAR ===== -->
  <nav class="navbar">
    <div class="nav-left">
      <img src="/librarylogo.png" alt="Library Logo" class="logo-img" />
      <h1 class="logo-text">Library System</h1>
    </div>

    <div class="nav-center">
      <button [class.active]="activeSection === 'books'" (click)="setActive('books')">Books</button>
      <button [class.active]="activeSection === 'borrowed'" (click)="setActive('borrowed')">Borrowed</button>
      <button [class.active]="activeSection === 'return'" (click)="setActive('return')">Return</button>
      <button [class.active]="activeSection === 'history'" (click)="setActive('history')">History</button>
    </div>

    <div class="nav-right">
      <input
        type="text"
        placeholder="🔍 Search books..."
        [(ngModel)]="searchQuery"
        (input)="searchBooks()"
      />
      <span class="greeting">Hi, {{ studentName }}</span>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
  </nav>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="content">
    <!-- ===== BOOKS SECTION ===== -->
    <section *ngIf="activeSection === 'books'">
      <h2 class="section-title">Available Books</h2>

      <div *ngIf="filteredBooks.length > 0; else noBooks" class="book-grid">
        <div *ngFor="let book of filteredBooks" class="book-card">
          <img
            *ngIf="book.imageUrl"
            [src]="book.imageUrl"
            alt="{{ book.title }}"
            class="book-img"
          />
          <h3 class="book-title">{{ book.title }}</h3>
          <p class="book-author">{{ book.author }}</p>
          <p class="book-stock">Stock: {{ book.stock }}</p>

          <button
            class="borrow-btn"
            (click)="borrowBook(book.id!)"
            [disabled]="book.stock === 0"
          >
            {{ book.stock === 0 ? 'Out of Stock' : 'Borrow' }}
          </button>
        </div>
      </div>

      <ng-template #noBooks>
        <p class="empty">No books found.</p>
      </ng-template>
    </section>

    <!-- ===== BORROWED SECTION ===== -->
    <section *ngIf="activeSection === 'borrowed'">
      <h2 class="section-title">Borrowed Books</h2>
      <div *ngIf="borrowed.length === 0" class="empty-msg">No borrowed books yet.</div>
      <div class="book-grid" *ngIf="borrowed.length > 0">
        <div *ngFor="let b of borrowed" class="book-card">
          <img
            *ngIf="b.book?.imageUrl"
            [src]="b.book.imageUrl"
            alt="{{ b.book?.title }}"
            class="book-img"
          />
          <h3 class="book-title">{{ b.book?.title }}</h3>
          <p>Borrowed on: {{ b.borrowDate | date: 'mediumDate' }}</p>
        </div>
      </div>
    </section>

    <!-- ===== RETURN SECTION ===== -->
    <section *ngIf="activeSection === 'return'">
      <h2 class="section-title">Return Books</h2>
      <div *ngIf="borrowed.length === 0" class="empty-msg">You have no books to return.</div>
      <div class="book-grid" *ngIf="borrowed.length > 0">
        <div *ngFor="let b of borrowed" class="book-card">
          <img
            *ngIf="b.book?.imageUrl"
            [src]="b.book.imageUrl"
            alt="{{ b.book?.title }}"
            class="book-img"
          />
          <h3 class="book-title">{{ b.book?.title }}</h3>
          <p>Borrowed on: {{ b.borrowDate | date: 'mediumDate' }}</p>
          <button class="return-btn" (click)="returnBook(b.id!)">Return</button>
        </div>
      </div>
    </section>

    <!-- ===== HISTORY SECTION ===== -->
    <section *ngIf="activeSection === 'history'">
      <h2 class="section-title">Borrow History</h2>
      <div *ngIf="history.length === 0" class="empty-msg">No borrow history yet.</div>
      <div class="book-grid" *ngIf="history.length > 0">
        <div *ngFor="let h of history" class="book-card">
          <img
            *ngIf="h.book?.imageUrl"
            [src]="h.book.imageUrl"
            alt="{{ h.book?.title }}"
            class="book-img"
          />
          <h3 class="book-title">{{ h.book?.title }}</h3>
          <p>Borrowed: {{ h.borrowDate | date: 'mediumDate' }}</p>
          <p *ngIf="h.returnDate">Returned: {{ h.returnDate | date: 'mediumDate' }}</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <p>Library Management System © 2025 | All Rights Reserved</p>
  </footer>
</div>
